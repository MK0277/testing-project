<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Uploaded Courses (Inline View)</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
  <!-- Menu -->
  <script src="menu.js"></script>

  <!-- Style -->
  <link rel="stylesheet" href="css/index-style.css">
  <style>
    body {
      background: #f8f9fa;
    }

    .page-wrap {
      max-width: 1100px;
      margin: 30px auto;
      padding: 0 1rem;
    }

    .category-title {
      color: #0d6efd;
      font-weight: 700;
      margin-top: 1.5rem;
      margin-bottom: .5rem;
      font-size: 1.25rem;
    }

    .course-card {
      border-radius: .75rem;
      box-shadow: 0 6px 18px rgba(13, 110, 253, 0.06);
      background: #fff;
      padding: .75rem;
      margin-bottom: 1.5rem;
    }

    .course-item {
      padding: .75rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      border-bottom: 1px solid #f1f1f1;
      gap: 0.75rem;
    }

    .course-left {
      display: flex;
      align-items: center;
      gap: .75rem;
      flex: 1 1 auto;
      min-width: 200px;
    }

    .course-name {
      font-weight: 600;
      font-size: 1rem;
    }

    .course-meta {
      font-size: .875rem;
      color: #6c757d;
    }

    .icon-btn {
      cursor: pointer;
      border: none;
      background: transparent;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: .3rem;
      padding: .25rem .5rem;
      transition: all 0.2s ease-in-out;
    }

    .icon-btn:hover {
      transform: scale(1.05);
    }

    .icon-label {
      font-size: .9rem;
      font-weight: 500;
    }

    .badge-count {
      font-size: .75rem;
      margin-left: .5rem;
    }

    .empty-msg {
      text-align: center;
      color: #6c757d;
      padding: 2rem 0;
    }

    .loader {
      text-align: center;
      padding: 2rem 0;
      color: #6c757d;
    }

    .modal-body {
      max-height: 60vh;
      overflow-y: auto;
    }

    .file-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      margin-bottom: 0.75rem;
      background: #fff;
      transition: all 0.2s ease-in-out;
      flex-wrap: wrap;
    }

    .file-row:hover {
      background: #f1f5ff;
    }

    /* üéØ Responsive adjustments */
    @media (max-width: 992px) {
      .hero-section {
        height: 60vh;
      }

      .display-4 {
        font-size: 2rem;
      }

      .lead {
        font-size: 1rem;
      }
    }

    @media (max-width: 768px) {
      .course-item {
        flex-direction: column;
        align-items: flex-start;
        padding: 1rem;
      }

      .course-left {
        width: 100%;
        justify-content: space-between;
      }

      .d-flex.align-items-center {
        width: 100%;
        justify-content: space-around;
        margin-top: 0.5rem;
      }

      .icon-btn {
        font-size: 0.95rem;
      }

      .badge-count {
        margin-left: 0.25rem;
      }

      .category-title {
        font-size: 1.15rem;
      }

      .page-wrap {
        margin: 20px auto;
      }
    }

    @media (max-width: 576px) {
      .hero-section {
        height: 55vh;
      }

      .display-4 {
        font-size: 1.75rem;
      }

      .lead {
        font-size: 0.95rem;
      }

      .course-card {
        padding: 0.75rem;
      }

      .course-item {
        gap: 0.5rem;
      }

      .icon-label {
        display: none;
      }

      .icon-btn i {
        font-size: 1.2rem;
      }
    }
  </style>

</head>

<body>
  <section class="hero-section position-relative text-white overflow-hidden" style="height:70vh">

    <!-- Background video --><video autoplay muted loop playsinline
      class="position-absolute top-0 start-0 w-100 h-100 object-fit-cover">

      <source src="assets/video/course-video.mp4" type="video/mp4" />Your browser does not support the video

      tag.

    </video>

    <!-- Overlay -->

    <div class="position-absolute top-0 start-0 w-100 h-100" style="background: rgba(0, 0, 0, 0.842);"></div>

    <!-- Text Content -->

    <div class="position-absolute top-50 start-50 translate-middle text-center px-3">

      <h1 class="display-4 fw-bold mb-3" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.7);">‚ÄúExplore & Download Course
        Syllabus and Notes‚Äù </h1>

      <p class="lead fw-semibold" style="text-shadow: 1px 1px 5px rgba(0,0,0,0.6);"> Access comprehensive course
        materials, notes, and syllabi to enhance your learning </p>

      <!-- Example Menu Button -->

      <!-- <button class="btn btn-apply btn-primary" data-bs-toggle="modal" data-bs-target="#applyProjectModal">

        Apply for a Project

      </button> -->

    </div>

  </section>
  <div class="page-wrap container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">üìÇ Download Notes And Syllabus</h3>
      <button id="refreshBtn" class="btn btn-outline-primary btn-sm">
        <i class="bi bi-arrow-clockwise"></i> Refresh
      </button>
    </div>

    <div id="courseContent" class="mb-5">
      <div class="loader">Loading courses...</div>
    </div>

    <hr />
    <p class="small text-muted">
      Click the <span class="text-success">Notes</span> or <span class="text-warning">Syllabus</span> icons to view
      available files.
    </p>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="pdfListModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md">
      <div class="modal-content shadow-lg">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="pdfListTitle">Files</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="pdfListContainer">
          <p class="text-center text-muted">No PDFs uploaded yet.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function () {
      const webAppUrl = "https://script.google.com/macros/s/AKfycbxqpdzBC_zCV8Ubn_lhr1gZCAYdFfknCGdES9DQy4lcsVi21y6nm0UAdIFilzdkDWPq-g/exec";
      const courseContent = document.getElementById("courseContent");
      const refreshBtn = document.getElementById("refreshBtn");

      window.allCoursesData = {};

      function getFileName(r) {
        return r.FileName || r["File Name"] || r.fileName || r.filename || r.name || "Unnamed File";
      }
      function getUrl(r) {
        return r.URL || r.url || r.Url || r.link || "#";
      }

      function groupRecords(records) {
        const grouped = {};
        records.forEach(r => {
          const Category = r.Category || "Unknown Category";
          const Course = r.Course || "Unknown Course";
          const Type = r.Type || "";
          const FileName = getFileName(r);
          const URL = getUrl(r);
          if (!grouped[Category]) grouped[Category] = {};
          if (!grouped[Category][Course]) grouped[Category][Course] = { notes: [], syllabus: [] };
          const fileData = { name: FileName, url: URL };
          if (Type.toLowerCase().includes("note")) grouped[Category][Course].notes.push(fileData);
          else grouped[Category][Course].syllabus.push(fileData);
        });
        return grouped;
      }

      function renderCourses(grouped) {
        courseContent.innerHTML = "";
        const categories = Object.keys(grouped);
        if (!categories.length) {
          courseContent.innerHTML = '<div class="empty-msg">No uploaded courses yet.</div>';
          return;
        }

        categories.forEach(category => {
          const catTitle = document.createElement("div");
          catTitle.className = "category-title";
          catTitle.textContent = category;
          courseContent.appendChild(catTitle);

          const catCard = document.createElement("div");
          catCard.className = "card course-card p-2 mb-3";
          const inner = document.createElement("div");
          inner.className = "list-group list-group-flush";

          Object.keys(grouped[category]).forEach(course => {
            const cObj = grouped[category][course];
            const notesCount = cObj.notes.length;
            const sylCount = cObj.syllabus.length;

            const item = document.createElement("div");
            item.className = "course-item";
            item.innerHTML = `
              <div class="course-left">
                <div>
                  <div class="course-name">${course}</div>
                  <div class="course-meta">${category}</div>
                </div>
              </div>
              <div class="d-flex align-items-center">
                <button class="icon-btn text-success" data-category="${category}" data-course="${course}" data-type="notes">
                  <i class="bi bi-book fs-5"></i><span class="icon-label">Notes</span>
                </button>
                <span class="badge bg-success text-white badge-count">${notesCount}</span>

                <button class="icon-btn text-warning ms-3" data-category="${category}" data-course="${course}" data-type="syllabus">
                  <i class="bi bi-file-earmark-text fs-5"></i><span class="icon-label">Syllabus</span>
                </button>
                <span class="badge bg-warning text-dark badge-count">${sylCount}</span>
              </div>`;
            inner.appendChild(item);
          });

          catCard.appendChild(inner);
          courseContent.appendChild(catCard);
        });
      }

      async function loadData() {
        courseContent.innerHTML = '<div class="loader">Loading courses...</div>';
        try {
          const res = await fetch(`${webAppUrl}?action=getAllCourses`);
          const data = await res.json();
          if (!data.success || !data.records?.length) {
            courseContent.innerHTML = '<div class="empty-msg">No uploaded courses yet.</div>';
            return;
          }
          const grouped = groupRecords(data.records);
          window.allCoursesData = grouped;
          renderCourses(grouped);
        } catch (err) {
          courseContent.innerHTML = `<div class="empty-msg text-danger">Error loading: ${err.message}</div>`;
        }
      }

      function openModal(category, course, type) {
        const data = window.allCoursesData[category]?.[course]?.[type] || [];
        const title = document.getElementById("pdfListTitle");
        const container = document.getElementById("pdfListContainer");
        title.textContent = `${course} ‚Äî ${type.charAt(0).toUpperCase() + type.slice(1)}`;
        container.innerHTML = data.length
          ? data.map(f => `
              <div class="file-row">
                <div><i class="bi bi-file-earmark-pdf text-danger me-2"></i><strong>${f.name}</strong></div>
                <a href="${f.url}" target="_blank" class="btn btn-sm btn-outline-primary"><i class="bi bi-download"></i> Download</a>
              </div>
            `).join("")
          : '<p class="text-center text-muted">No files uploaded yet.</p>';

        new bootstrap.Modal(document.getElementById("pdfListModal")).show();
      }

      document.addEventListener("click", e => {
        const btn = e.target.closest("button.icon-btn");
        if (!btn) return;
        openModal(btn.dataset.category, btn.dataset.course, btn.dataset.type);
      });

      refreshBtn.addEventListener("click", loadData);
      loadData();
    })();
  </script>
  <!-- Footer -->
  <script src="footer.js"></script>
</body>

</html>